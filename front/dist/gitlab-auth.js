!function(){var GitLabLoginButtonDirective=function($window,$params,$location,$config,$events,$confirm,$auth,$navUrls,$loader){return{link:function($scope,$el,$attrs){var auth_url=$config.get("gitLabUrl",null),clientId=$config.get("gitLabClientId",null),loginOnSuccess=function(response){var nextUrl=$params.next&&$params.next!==$navUrls.resolve("login")?$params.next:$navUrls.resolve("home");return $events.setupConnection(),$location.search("next",null),$location.search("token",null),$location.search("state",null),$location.search("code",null),$location.path(nextUrl)},loginOnError=function(response){return $location.search("state",null),$location.search("code",null),$loader.pageLoaded(),response.data._error_message?$confirm.notify("light-error",response.data._error_message):$confirm.notify("light-error","Our Oompa Loompas have not been able to get you credentials from GitLab.")};return function(){var url,type=$params.state,code=$params.code,token=$params.token;if("gitlab"===type&&code)return $loader.start(!0),(url=document.createElement("a")).href=$location.absUrl(),url=url.protocol+"//"+url.hostname+(""===url.port?"":":"+url.port)+window.taigaConfig.baseHref+"login",$auth.login({code:code,token:token,redirectUri:url},type).then(loginOnSuccess,loginOnError)}(),$el.on("click",".button-auth",function(event){var redirectToUri,url=document.createElement("a");return url.href=$location.absUrl(),redirectToUri=url.protocol+"//"+url.hostname+(""===url.port?"":":"+url.port)+window.taigaConfig.baseHref+"login",$window.location.href=url=auth_url+"/oauth/authorize?client_id="+clientId+"&state=gitlab&response_type=code&scope=read_user&redirect_uri="+redirectToUri}),$scope.$on("$destroy",function(){return $el.off()})},restrict:"EA",template:""}};angular.module("taigaContrib.gitlabAuth",[]).directive("tgGitlabLoginButton",["$window","$routeParams","$tgLocation","$tgConfig","$tgEvents","$tgConfirm","$tgAuth","$tgNavUrls","tgLoader",GitLabLoginButtonDirective])}.call(this),angular.module("templates").run(["$templateCache",function($templateCache){$templateCache.put("/plugins/gitlab-auth/gitlab-auth.html",'\n<div tg-gitlab-login-button="tg-gitlab-login-button"><a href="" title="Enter with your gitlab account" class="button button-auth"><img src="plugins/gitlab-auth/images/gitlab-logo.png" alt=""/><span>Sign in with GitLab</span></a></div>')}]);